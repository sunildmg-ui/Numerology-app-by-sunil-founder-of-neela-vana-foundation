import React, { useState } from 'react';
import { Calendar, User, Star, Sparkles, AlertCircle, TrendingUp, Heart, Phone, Users, Sun, Shield, Home, Watch, Activity, BookOpen, Zap } from 'lucide-react';

const LoShuGridApp = () => {
  const [step, setStep] = useState(1);
  const [formData, setFormData] = useState({
    day: '',
    month: '',
    year: '',
    gender: '',
    name: '',
    spouseDay: '',
    spouseMonth: '',
    spouseYear: '',
    spouseGender: '',
    mobile: ''
  });
  const [results, setResults] = useState(null);
  const [showResults, setShowResults] = useState(false);
  const [checkNumber, setCheckNumber] = useState('');

  const chaldeanMap = {
    A: 1, I: 1, J: 1, Q: 1, Y: 1,
    B: 2, K: 2, R: 2,
    C: 3, G: 3, L: 3, S: 3,
    D: 4, M: 4, T: 4,
    E: 5, H: 5, N: 5, X: 5,
    U: 6, V: 6, W: 6,
    O: 7, Z: 7,
    F: 8, P: 8
  };

  const relationshipTable = {
    1: { friends: [1, 2, 3, 9], neutral: [6], enemies: [4, 5, 7, 8] },
    2: { friends: [1, 2, 3, 7, 9], neutral: [5, 6], enemies: [4, 8] },
    3: { friends: [1, 2, 3, 9], neutral: [6], enemies: [4, 5, 7, 8] },
    4: { friends: [5, 6, 7, 8], neutral: [2], enemies: [1, 3, 9] },
    5: { friends: [4, 5, 6], neutral: [2, 7, 8], enemies: [1, 3, 9] },
    6: { friends: [4, 5, 6, 7, 8], neutral: [1, 2, 3], enemies: [9] },
    7: { friends: [2, 4, 6, 7], neutral: [5, 8], enemies: [1, 3, 9] },
    8: { friends: [4, 5, 6, 8], neutral: [7], enemies: [1, 2, 3, 9] },
    9: { friends: [1, 2, 3, 9], neutral: [], enemies: [4, 5, 6, 7, 8] }
  };

  // Comprehensive number database with Pythagorean & Cheiro wisdom
  const numberDatabase = {
    1: {
      element: 'Water',
      plane: 'Physical (Practical)',
      symbolism: 'Divine Expression & Ego',
      keyTraits: 'Communication, Career, Money, Self-Expression',
      strengths: 'Independent, ambitious, creative, leadership qualities, pioneering spirit',
      challenges: 'Egotism, stubbornness, dominance, difficulty expressing emotions',
      lifePurpose: 'To develop individuality and lead through verbal expression',
      suitableCareer: 'Entrepreneurs, speakers, writers, politicians, sales professionals',
      healthFocus: 'Heart, circulation, head-related issues',
      spiritualLesson: 'Learning to balance ego with compassion and selfless service',
      relationships: 'Natural leaders in relationships; must learn to listen and share power',
      bestWith: 'Numbers 2, 3, 9 (friends); Number 6 (neutral)',
      avoid: 'Numbers 4, 5, 7, 8 (challenging energies)',
      vibration: 'Sun energy - represents the self, vitality, and life force'
    },
    2: {
      element: 'Earth',
      plane: 'Soul (Feeling)',
      symbolism: 'Duality & Sensitivity',
      keyTraits: 'Marriage, Sensitivity, Intuition, Cooperation',
      strengths: 'Diplomatic, intuitive, supportive, peacemaking, gentle nature',
      challenges: 'Over-sensitivity, indecisiveness, dependency, easily hurt',
      lifePurpose: 'To develop intuition and create harmony in partnerships',
      suitableCareer: 'Counselors, mediators, artists, diplomats, support roles',
      healthFocus: 'Digestive system, emotional balance, stomach issues',
      spiritualLesson: 'Developing patience and trusting inner guidance',
      relationships: 'Natural partners; thrive in harmonious relationships',
      bestWith: 'Numbers 1, 3, 7, 9 (friends)',
      avoid: 'Numbers 4, 8 (conflicting energies)',
      vibration: 'Moon energy - represents emotions, intuition, and receptivity'
    },
    3: {
      element: 'Wood',
      plane: 'Mind (Thinking)',
      symbolism: 'Trinity of Mind, Soul, Body',
      keyTraits: 'Growth, Education, Family, Memory, Creativity',
      strengths: 'Intellectual, analytical, creative thinker, excellent memory',
      challenges: 'Over-analysis, criticism, disconnection from emotions',
      lifePurpose: 'To use mental gifts for creative expression and teaching',
      suitableCareer: 'Teachers, scientists, analysts, entertainers, writers',
      healthFocus: 'Nervous system, mental stress, thyroid',
      spiritualLesson: 'Connecting mind with heart; avoiding mental superiority',
      relationships: 'Mental connection important; need intellectual stimulation',
      bestWith: 'Numbers 1, 2, 9 (supportive)',
      avoid: 'Numbers 4, 5, 7, 8 (different wavelengths)',
      vibration: 'Jupiter energy - represents expansion, wisdom, and knowledge'
    },
    4: {
      element: 'Wood',
      plane: 'Physical (Practical)',
      symbolism: 'Square - Foundation & Order',
      keyTraits: 'Wealth, Discipline, Organization, Practicality',
      strengths: 'Reliable, organized, hardworking, builds solid foundations',
      challenges: 'Rigidity, materialism, stubbornness, impatience',
      lifePurpose: 'To create stability and material security through practical efforts',
      suitableCareer: 'Builders, accountants, engineers, managers, skilled trades',
      healthFocus: 'Bones, joints, physical endurance',
      spiritualLesson: 'Finding balance between material and spiritual pursuits',
      relationships: 'Loyal and stable; may struggle with emotional expression',
      bestWith: 'Numbers 5, 6, 7, 8 (earth and metal elements)',
      avoid: 'Numbers 1, 3, 9 (fire and air clash)',
      vibration: 'Rahu (North Node) energy - represents worldly desires and karma'
    },
    5: {
      element: 'Earth',
      plane: 'Soul (Feeling)',
      symbolism: 'Center Point - Balance & Freedom',
      keyTraits: 'Stability, Business, Balance, Love, Freedom',
      strengths: 'Versatile, adventurous, magnetic personality, natural business sense',
      challenges: 'Restlessness, impulsiveness, scattered energy when excessive',
      lifePurpose: 'To experience life fully and bring balance to all situations',
      suitableCareer: 'Entrepreneurs, traders, travel industry, marketing, sales',
      healthFocus: 'Nervous system, stress management, need for physical activity',
      spiritualLesson: 'Finding inner stability while embracing change',
      relationships: 'Need freedom and variety; can be charming but restless',
      bestWith: 'Numbers 4, 6 (complementary)',
      avoid: 'Numbers 1, 3, 9 when excessive (too much fire)',
      vibration: 'Mercury energy - represents communication, commerce, and adaptability',
      specialNote: 'CRITICAL NUMBER - Missing 5 causes extreme imbalance in all life areas'
    },
    6: {
      element: 'Metal',
      plane: 'Mind (Thinking)',
      symbolism: 'Harmony & Creativity',
      keyTraits: 'Luxury, Support, Travel, Family, Artistic Expression',
      strengths: 'Creative, nurturing, responsible, loves beauty and comfort',
      challenges: 'Worry, anxiety, over-responsibility, controlling tendencies',
      lifePurpose: 'To create beauty and harmony while serving family and community',
      suitableCareer: 'Artists, designers, healers, teachers, hospitality',
      healthFocus: 'Throat, respiratory system, tendency toward anxiety',
      spiritualLesson: 'Letting go of worry and trusting divine timing',
      relationships: 'Devoted and caring; may become overly protective',
      bestWith: 'Numbers 4, 5, 7, 8 (harmonious blend)',
      avoid: 'Number 9 (conflicting purpose)',
      vibration: 'Venus energy - represents love, beauty, and material comforts'
    },
    7: {
      element: 'Metal',
      plane: 'Physical (Practical)',
      symbolism: 'Seven Chakras - Spiritual Learning',
      keyTraits: 'Children, Spirituality, Learning Through Experience',
      strengths: 'Philosophical, analytical, seeks truth, spiritual depth',
      challenges: 'Isolation, skepticism, difficulty trusting others',
      lifePurpose: 'To gain wisdom through personal experience and teach others',
      suitableCareer: 'Researchers, spiritual teachers, analysts, investigators',
      healthFocus: 'Seven chakras, need for meditation and inner work',
      spiritualLesson: 'Learning through sacrifice; developing faith and trust',
      relationships: 'Deep connections but can be emotionally guarded',
      bestWith: 'Numbers 2, 4, 6 (supportive)',
      avoid: 'Numbers 1, 3, 9 (different life approach)',
      vibration: 'Ketu (South Node) energy - represents spiritual liberation and detachment'
    },
    8: {
      element: 'Earth',
      plane: 'Soul (Feeling)',
      symbolism: 'Infinity - Karma & Justice',
      keyTraits: 'Profession, Justice, Property, Independence, Wisdom',
      strengths: 'Powerful, ambitious, seeks justice, financial acumen',
      challenges: 'Workaholism, power struggles, karmic lessons',
      lifePurpose: 'To use power wisely and manifest spiritual wisdom through action',
      suitableCareer: 'Executives, judges, real estate, financial management',
      healthFocus: 'Liver, stress-related issues, need for work-life balance',
      spiritualLesson: 'Using power for good; understanding karmic responsibility',
      relationships: 'Strong personalities; need independence in partnerships',
      bestWith: 'Numbers 4, 5, 6 (compatible)',
      avoid: 'Numbers 1, 2, 3, 9 (power conflicts)',
      vibration: 'Saturn energy - represents discipline, responsibility, and karmic lessons'
    },
    9: {
      element: 'Fire',
      plane: 'Mind (Thinking)',
      symbolism: 'Completion - Humanitarian Service',
      keyTraits: 'Fame, Recognition, Energy, Ambition, Idealism',
      strengths: 'Compassionate, idealistic, ambitious, natural leaders',
      challenges: 'Impracticality, excessive idealism, aggression',
      lifePurpose: 'To serve humanity and lead through idealistic vision',
      suitableCareer: 'Humanitarian work, military, sports, leadership roles',
      healthFocus: 'Energy levels, blood pressure, need for physical activity',
      spiritualLesson: 'Grounding ideals in practical action; avoiding ego in service',
      relationships: 'Passionate but may prioritize mission over intimacy',
      bestWith: 'Numbers 1, 2, 3 (harmonious)',
      avoid: 'Numbers 4, 5, 6, 7, 8 (conflicting energies)',
      vibration: 'Mars energy - represents action, courage, and warrior spirit'
    }
  };

  const completeRemedyDatabase = {
    1: {
      element: 'Water',
      direction: 'North',
      trait: 'Communication, Career, Money',
      problem: 'Lack of communication skills and career planning',
      fengShui: 'Place an Aquarium or small water fountain in the North. A painting of a waterfall (calm water) also works.',
      wearable: 'Wear a Blue Sapphire (with caution) or Blue crystal bracelet. Tie a red thread on right wrist.',
      lifestyle: 'Keep Money Plant in blue bottle. Avoid ego; serve water to others. Practice Surya Namaskar.',
      easyFix: 'Tie a red thread on your right wrist',
      priority: 3,
      planetaryInfluence: 'Sun',
      additionalInfo: 'Number 1 represents the beginning, leadership, and independence. Missing this affects your ability to stand alone and express yourself confidently.'
    },
    2: {
      element: 'Earth',
      direction: 'South-West',
      trait: 'Marriage, Sensitivity, Intuition',
      problem: 'Relationship issues, lack of patience, trust problems',
      fengShui: 'Place a pair of Crystal Swans or Love Birds in SW. Hang picture of mountains (no water) in SW.',
      wearable: 'Wear Silver items (ring/chain). Carry a square piece of silver in wallet.',
      lifestyle: 'Respect your Mother. Offer water to Shivling. Drink water from silver glass. Practice patience.',
      easyFix: 'Wear silver ring on right hand',
      priority: 2,
      planetaryInfluence: 'Moon',
      additionalInfo: 'Number 2 is about duality, partnerships, and cooperation. Missing this creates difficulty in relationships and emotional understanding.'
    },
    3: {
      element: 'Wood',
      direction: 'East',
      trait: 'Growth, Education, Family',
      problem: 'Focus issues, study delays, family conflicts',
      fengShui: 'Place Green Plants (Bamboo/Money Plant) in East. Use wooden furniture or decor in this area.',
      wearable: 'Wear Tulsi Mala (Holy Basil beads) or Yellow Sapphire substitute (Citrine).',
      lifestyle: 'Respect Teachers & Elders. Donate yellow sweets/items on Thursdays. Read daily.',
      easyFix: 'Wear a Tulsi Mala daily',
      priority: 2,
      planetaryInfluence: 'Jupiter',
      additionalInfo: 'Number 3 represents creativity, expression, and mental abilities. Missing this affects your ability to articulate thoughts and remember important details.'
    },
    4: {
      element: 'Wood',
      direction: 'South-East',
      trait: 'Wealth, Discipline',
      problem: 'Financial instability, disorganization, lack of savings',
      fengShui: 'Place Green Scenery or 4 stalks of Lucky Bamboo in SE. Keep Green Bulb lit here.',
      wearable: 'Wear Rudraksha mala (5 Mukhi). Wear green crystal bracelet (Green Aventurine).',
      lifestyle: 'Maintain strict cleanliness. Use wooden pen. Donate to poor/cleaners. Keep a budget diary.',
      easyFix: 'Wear a 5 Mukhi Rudraksha',
      priority: 1,
      planetaryInfluence: 'Rahu (North Node)',
      additionalInfo: 'Number 4 is the foundation, stability, and hard work. Missing this creates financial challenges and lack of systematic approach to life.'
    },
    5: {
      element: 'Earth',
      direction: 'Center',
      trait: 'Stability, Business, Balance',
      problem: 'CRITICAL - Extreme difficulty finding balance, bad luck in all areas',
      fengShui: 'Keep center of house empty/clean. Place Yellow Pyramid or Camel statue here.',
      wearable: 'Wear Gold or Brass ornaments. Wear Citrine or Crystal Quartz bracelet.',
      lifestyle: 'Feed birds (green grains). Keep teeth clean. Stay balanced in decisions. Practice moderation.',
      easyFix: 'Wear gold/brass jewelry daily',
      priority: 1,
      planetaryInfluence: 'Mercury',
      additionalInfo: 'Number 5 is the CENTER of the grid - represents freedom, change, and balance. Missing this is MOST CRITICAL as it affects ALL areas of life.'
    },
    6: {
      element: 'Metal',
      direction: 'North-West',
      trait: 'Luxury, Support, Travel',
      problem: 'Lack of luxury, family support, and travel luck',
      fengShui: 'Hang Golden Windchime (6 rods) in NW. Place Golden Metal Turtle in North.',
      wearable: 'Wear Golden Watch (metal strap) or gold bracelet. Use luxury perfume daily.',
      lifestyle: 'Respect Women/Spouse. Keep NW corner well-lit. Dress well (groomed). Maintain good relationships.',
      easyFix: 'Wear a golden metal watch',
      priority: 1,
      planetaryInfluence: 'Venus',
      additionalInfo: 'Number 6 represents love, responsibility, and nurturing. Missing this causes lack of family support and difficulty enjoying life\'s luxuries.'
    },
    7: {
      element: 'Metal',
      direction: 'West',
      trait: 'Children, Spirituality, Relationships',
      problem: 'Anxiety, over-trusting, spiritual disconnect, children issues',
      fengShui: 'Hang Silver Windchime (7 rods) in West. Place Silver Elephant statue.',
      wearable: 'Wear Silver Watch or jointless Silver Bangle (Kada). Wear Cats Eye (Lehsuniya).',
      lifestyle: 'Feed Stray Dogs. Practice meditation/yoga. Avoid over-trusting strangers. Spend time in nature.',
      easyFix: 'Wear silver watch or kada',
      priority: 2,
      planetaryInfluence: 'Ketu (South Node)',
      additionalInfo: 'Number 7 is about spiritual seeking and learning through experience. Missing this creates difficulty in faith and spiritual understanding.'
    },
    8: {
      element: 'Earth',
      direction: 'North-East',
      trait: 'Profession, Justice, Property',
      problem: 'Career struggle, hard work without results, property issues',
      fengShui: 'Place Crystal Lotus or Earth Globe in NE. Keep heavy rock/statue in SW (balance).',
      wearable: 'Wear Amethyst bracelet. Wear dark blue or black clothes on Saturdays.',
      lifestyle: 'Help Labor Class (workers). Do not eat non-veg on Saturdays. Feed ants. Maintain discipline.',
      easyFix: 'Wear an Amethyst bracelet',
      priority: 2,
      planetaryInfluence: 'Saturn',
      additionalInfo: 'Number 8 represents karma, authority, and material success. Missing this causes delays in career recognition and difficulty with authority.'
    },
    9: {
      element: 'Fire',
      direction: 'South',
      trait: 'Fame, Recognition, Energy',
      problem: 'Lack of recognition, low energy, no fame',
      fengShui: 'Keep Red Bulb always lit in South. Place picture of rising sun or mountains in South.',
      wearable: 'Wear Red Thread (Mauli) on wrist. Wear Coral (Moonga) if Mars is weak.',
      lifestyle: 'Practice Yoga/Gym (sweat daily). Chant Hanuman Chalisa. Donate blood or red lentils. Be active.',
      easyFix: 'Wear red thread on right wrist',
      priority: 3,
      planetaryInfluence: 'Mars',
      additionalInfo: 'Number 9 is completion, humanitarian service, and leadership. Missing this causes lack of motivation and difficulty completing tasks.'
    }
  };

  const personalDayMeanings = {
    1: { vibe: 'New Beginnings', description: 'Start new projects, take initiative, focus on yourself', pythagorean: 'Day of Sun - Plant seeds for future success' },
    2: { vibe: 'Cooperation', description: 'Work with others, be patient, focus on relationships', pythagorean: 'Day of Moon - Nurture connections' },
    3: { vibe: 'Creativity', description: 'Express yourself, socialize, have fun', pythagorean: 'Day of Jupiter - Expand your horizons' },
    4: { vibe: 'Hard Work', description: 'Build foundations, be practical, organize', pythagorean: 'Day of Rahu - Focus on material stability' },
    5: { vibe: 'Change', description: 'Embrace flexibility, try new things, travel', pythagorean: 'Day of Mercury - Communicate and adapt' },
    6: { vibe: 'Responsibility', description: 'Focus on family, home, service to others', pythagorean: 'Day of Venus - Create harmony and beauty' },
    7: { vibe: 'Reflection', description: 'Meditate, study, seek inner wisdom', pythagorean: 'Day of Ketu - Go within for answers' },
    8: { vibe: 'Power', description: 'Business matters, financial decisions, authority', pythagorean: 'Day of Saturn - Face responsibilities' },
    9: { vibe: 'Completion', description: 'Finish projects, let go, be compassionate', pythagorean: 'Day of Mars - Take decisive action' }
  };

  const checkRelationship = (driver, target) => {
    const table = relationshipTable[driver];
    if (table.friends.includes(target)) {
      return { status: 'Super Compatible', emoji: '✅', color: 'green', advice: 'Excellent day for major decisions!' };
    } else if (table.neutral.includes(target)) {
      return { status: 'Neutral', emoji: '⚪', color: 'yellow', advice: 'Workable day, proceed with awareness' };
    } else {
      return { status: 'Challenging', emoji: '⚠️', color: 'red', advice: 'Avoid major decisions today' };
    }
  };

  const calculatePersonalDay = (birthDay, birthMonth, birthYear) => {
    const today = new Date();
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth() + 1;
    const currentDay = today.getDate();

    let py = birthDay + birthMonth + currentYear;
    while (py > 9) {
      py = py.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }

    let pm = py + currentMonth;
    while (pm > 9) {
      pm = pm.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }

    let pd = pm + currentDay;
    while (pd > 9) {
      pd = pd.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }

    return { personalYear: py, personalMonth: pm, personalDay: pd, date: today.toDateString() };
  };

  const prioritizeRemedies = (missingNumbers) => {
    const sorted = missingNumbers.sort((a, b) => a.remedy.priority - b.remedy.priority);
    
    const goldenLine = missingNumbers.filter(m => [4, 5, 6].includes(m.number));
    const woodWeak = missingNumbers.filter(m => [3, 4].includes(m.number));
    const metalWeak = missingNumbers.filter(m => [6, 7].includes(m.number));
    
    return {
      priority: sorted,
      goldenLine: goldenLine.length > 0,
      woodWeak: woodWeak.length >= 2,
      metalWeak: metalWeak.length >= 2,
      recommendations: {
        golden: goldenLine.length > 0 ? 'Focus on Wealth, Stability & Luxury remedies first (4, 5, 6) - The Golden Yog' : null,
        wood: woodWeak.length >= 2 ? 'Wood element weak - Add green plants in East/South-East for growth energy' : null,
        metal: metalWeak.length >= 2 ? 'Metal element weak - Wear gold/silver watches for refinement' : null
      }
    };
  };

  const calculateNameNumber = (name) => {
    if (!name) return null;
    const cleanName = name.toUpperCase().replace(/[^A-Z]/g, '');
    let sum = 0;
    for (let char of cleanName) {
      sum += chaldeanMap[char] || 0;
    }
    while (sum > 9) {
      sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }
    return sum;
  };

  const calculateMobileNumber = (mobile) => {
    if (!mobile) return null;
    const digits = mobile.replace(/\D/g, '');
    let sum = digits.split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    while (sum > 9) {
      sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }
    return sum;
  };

  const calculateDriver = (day) => {
    let sum = day.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    while (sum > 9) {
      sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }
    return sum;
  };

  const calculateConductor = (day, month, year) => {
    const allDigits = `${day}${month}${year}`.split('').map(Number);
    let sum = allDigits.reduce((a, b) => a + b, 0);
    while (sum > 9) {
      sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }
    return sum;
  };

  const calculateKua = (year, gender) => {
    let yearSum = year.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    while (yearSum > 9) {
      yearSum = yearSum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }
    
    let kua;
    const isBefore2000 = parseInt(year) < 2000;
    
    if (gender === 'male') {
      kua = isBefore2000 ? 10 - yearSum : 9 - yearSum;
    } else {
      kua = isBefore2000 ? 5 + yearSum : 6 + yearSum;
    }
    
    while (kua > 9) {
      kua = kua.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
    }
    
    return kua;
  };

  const calculateGrid = (day, month, year, driver, conductor, kua) => {
    const grid = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };
    
    const allDigits = `${day}${month}${year}`.split('').map(Number).filter(n => n !== 0);
    allDigits.forEach(digit => grid[digit]++);
    
    grid[driver]++;
    grid[conductor]++;
    grid[kua]++;
    
    return grid;
  };

  const checkPlanes = (grid) => {
    const planes = {
      horizontal: [
        { name: 'Mental Plane (4-9-2)', numbers: [4, 9, 2], description: 'Excellent memory, intellectual, logical' },
        { name: 'Emotional Plane (3-5-7)', numbers: [3, 5, 7], description: 'Spiritually connected, emotional' },
        { name: 'Practical Plane (8-1-6)', numbers: [8, 1, 6], description: 'Material success, business-minded' }
      ],
      vertical: [
        { name: 'Thought Plane (4-3-8)', numbers: [4, 3, 8], description: 'Strong planner, visionary' },
        { name: 'Will Plane (9-5-1)', numbers: [9, 5, 1], description: 'Determined, persistent' },
        { name: 'Action Plane (2-7-6)', numbers: [2, 7, 6], description: 'Physically active' }
      ],
      diagonal: [
        { name: 'Golden Yog (4-5-6)', numbers: [4, 5, 6], description: 'EXTREMELY LUCKY! Wealth, fame, luxury' },
        { name: 'Silver Yog (2-5-8)', numbers: [2, 5, 8], description: 'Real estate luck, property gains' }
      ]
    };

    const active = [];
    Object.values(planes).flat().forEach(plane => {
      const isComplete = plane.numbers.every(num => grid[num] > 0);
      if (isComplete) {
        active.push(plane);
      }
    });

    return active;
  };

  const getNumberMeaning = (num) => {
    return numberDatabase[num];
  };

  const analyzeOverlays = (baseGrid, nameNum, spouseGrid, mobileNum) => {
    const overlays = {
      name: null,
      spouse: [],
      mobile: null,
      completedPlanes: []
    };

    if (nameNum) {
      const isMissing = baseGrid[nameNum] === 0;
      overlays.name = {
        number: nameNum,
        isMissing,
        meaning: getNumberMeaning(nameNum),
        impact: isMissing 
          ? `Fills missing ${getNumberMeaning(nameNum).keyTraits}!`
          : `Strengthens ${getNumberMeaning(nameNum).keyTraits}`
      };
    }

    if (spouseGrid) {
      const combined = { ...baseGrid };
      for (let i = 1; i <= 9; i++) {
        if (baseGrid[i] === 0 && spouseGrid[i] > 0) {
          overlays.spouse.push({
            number: i,
            meaning: getNumberMeaning(i),
            impact: `Brings ${getNumberMeaning(i).keyTraits}`
          });
          combined[i] = spouseGrid[i];
        }
      }
      
      const newPlanes = checkPlanes(combined);
      const basePlanes = checkPlanes(baseGrid);
      overlays.completedPlanes = newPlanes.filter(
        plane => !basePlanes.some(bp => bp.name === plane.name)
      );
    }

    if (mobileNum) {
      const isMissing = baseGrid[mobileNum] === 0;
      overlays.mobile = {
        number: mobileNum,
        isMissing,
        meaning: getNumberMeaning(mobileNum),
        impact: isMissing
          ? `Temporary remedy for ${getNumberMeaning(mobileNum).keyTraits}`
          : `Amplifies ${getNumberMeaning(mobileNum).keyTraits}`
      };
    }

    return overlays;
  };

  const handleCalculate = () => {
    const { day, month, year, gender, name, spouseDay, spouseMonth, spouseYear, spouseGender, mobile } = formData;
    
    if (!day || !month || !year || !gender) {
      alert('Please fill all required fields');
      return;
    }

    const driver = calculateDriver(parseInt(day));
    const conductor = calculateConductor(parseInt(day), parseInt(month), parseInt(year));
    const kua = calculateKua(parseInt(year), gender);
    const grid = calculateGrid(day, month, year, driver, conductor, kua);
    const activePlanes = checkPlanes(grid);
    
    const strengths = [];
    const missing = [];
    const allNumbers = [];
    
    for (let i = 1; i <= 9; i++) {
      const numberInfo = {
        number: i,
        count: grid[i],
        details: numberDatabase[i]
      };
      allNumbers.push(numberInfo);
      
      if (grid[i] >= 2) {
        strengths.push(numberInfo);
      }
      if (grid[i] === 0) {
        missing.push({ 
          number: i, 
          meaning: getNumberMeaning(i), 
          remedy: completeRemedyDatabase[i] 
        });
      }
    }

    const prioritized = prioritizeRemedies(missing);
    const nameNum = name ? calculateNameNumber(name) : null;
    
    let spouseGrid = null;
    if (spouseDay && spouseMonth && spouseYear && spouseGender) {
      const spouseDriver = calculateDriver(parseInt(spouseDay));
      const spouseConductor = calculateConductor(parseInt(spouseDay), parseInt(spouseMonth), parseInt(spouseYear));
      const spouseKua = calculateKua(parseInt(spouseYear), spouseGender);
      spouseGrid = calculateGrid(spouseDay, spouseMonth, spouseYear, spouseDriver, spouseConductor, spouseKua);
    }
    
    const mobileNum = mobile ? calculateMobileNumber(mobile) : null;
    const overlays = analyzeOverlays(grid, nameNum, spouseGrid, mobileNum);
    const dailyPrediction = calculatePersonalDay(parseInt(day), parseInt(month), parseInt(year));
    const dailyRelationship = checkRelationship(driver, dailyPrediction.personalDay);

    setResults({
      driver,
      conductor,
      kua,
      grid,
      activePlanes,
      strengths,
      missing,
      allNumbers,
      prioritized,
      nameNum,
      mobileNum,
      overlays,
      dailyPrediction,
      dailyRelationship
    });
    
    setShowResults(true);
  };

  const GridCell = ({ number, count }) => (
    <div className="flex items-center justify-center w-20 h-20 md:w-24 md:h-24 bg-white border-2 border-purple-300 rounded-lg shadow-md">
      <div className="text-center">
        <div className="text-2xl md:text-3xl font-bold text-purple-600">{number}</div>
        <div className="text-xs md:text-sm mt-1">
          {count === 0 ? (
            <span className="text-red-500 font-semibold">⚫</span>
          ) : (
            <span className="text-green-600 font-semibold">{'✓'.repeat(Math.min(count, 3))}</span>
          )}
        </div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-950 via-purple-900 to-pink-900 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        <div className="text-center mb-8">
          <h1 className="text-3xl md:text-5xl font-bold text-white mb-2 flex items-center justify-center gap-3 flex-wrap">
            <Sparkles className="text-yellow-400" />
            Lo Shu Grid App
            <Sparkles className="text-yellow-400" />
          </h1>
          <p className="text-lg font-semibold text-pink-400 mb-2">by Neela Foundation</p>
          <p className="text-gray-300 text-sm">Complete Pythagorean & Cheiro Numerology System</p>
        </div>

        {!showResults ? (
          <div className="bg-white rounded-2xl shadow-xl p-4 md:p-8">
            <div className="flex justify-center mb-6 gap-2">
              <button
                onClick={() => setStep(1)}
                className={`px-4 py-2 rounded-lg text-sm font-semibold ${
                  step === 1 ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-600'
                }`}
              >
                1. Basic
              </button>
              <button
                onClick={() => setStep(2)}
                className={`px-4 py-2 rounded-lg text-sm font-semibold ${
                  step === 2 ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-600'
                }`}
              >
                2. Optional
              </button>
            </div>

            {step === 1 && (
              <div className="space-y-6">
                <h3 className="text-xl font-bold text-purple-700 mb-4">Birth Details (Required)</h3>
                <div className="grid md:grid-cols-3 gap-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Day</label>
                    <input
                      type="number"
                      min="1"
                      max="31"
                      value={formData.day}
                      onChange={(e) => setFormData({...formData, day: e.target.value})}
                      className="w-full px-4 py-3 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:outline-none"
                      placeholder="DD"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Month</label>
                    <input
                      type="number"
                      min="1"
                      max="12"
                      value={formData.month}
                      onChange={(e) => setFormData({...formData, month: e.target.value})}
                      className="w-full px-4 py-3 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:outline-none"
                      placeholder="MM"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Year</label>
                    <input
                      type="number"
                      min="1900"
                      max="2025"
                      value={formData.year}
                      onChange={(e) => setFormData({...formData, year: e.target.value})}
                      className="w-full px-4 py-3 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:outline-none"
                      placeholder="YYYY"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">Gender</label>
                  <div className="flex gap-4">
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="radio"
                        name="gender"
                        value="male"
                        checked={formData.gender === 'male'}
                        onChange={(e) => setFormData({...formData, gender: e.target.value})}
                        className="w-5 h-5"
                      />
                      <span>Male</span>
                    </label>
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="radio"
                        name="gender"
                        value="female"
                        checked={formData.gender === 'female'}
                        onChange={(e) => setFormData({...formData, gender: e.target.value})}
                        className="w-5 h-5"
                      />
                      <span>Female</span>
                    </label>
                  </div>
                </div>

                <button
                  onClick={() => setStep(2)}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-semibold hover:opacity-90"
                >
                  Next: Add Overlays →
                </button>
                
                <button
                  onClick={handleCalculate}
                  className="w-full bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700"
                >
                  Skip & Calculate Now
                </button>
              </div>
            )}

            {step === 2 && (
              <div className="space-y-6">
                <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                  <p className="text-sm text-blue-800">
                    <strong>Optional:</strong> Add name, spouse, or mobile for complete analysis.
                  </p>
                </div>

                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">Your Full Name</label>
                  <input
                    type="text"
                    value={formData.name}
                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                    className="w-full px-4 py-3 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:outline-none"
                    placeholder="e.g., John Doe"
                  />
                  {formData.name && (
                    <p className="text-sm text-purple-600 mt-2">
                      Name Number: <strong>{calculateNameNumber(formData.name)}</strong>
                    </p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">Mobile Number</label>
                  <input
                    type="text"
                    value={formData.mobile}
                    onChange={(e) => setFormData({...formData, mobile: e.target.value})}
                    className="w-full px-4 py-3 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:outline-none"
                    placeholder="e.g., 9876543210"
                  />
                  {formData.mobile && formData.mobile.replace(/\D/g, '').length >= 10 && (
                    <p className="text-sm text-purple-600 mt-2">
                      Mobile Number: <strong>{calculateMobileNumber(formData.mobile)}</strong>
                    </p>
                  )}
                </div>

                <div className="border-t pt-6">
                  <h4 className="text-lg font-bold text-gray-700 mb-4">Spouse Details (Optional)</h4>
                  <div className="grid md:grid-cols-3 gap-4 mb-4">
                    <input
                      type="number"
                      min="1"
                      max="31"
                      value={formData.spouseDay}
                      onChange={(e) => setFormData({...formData, spouseDay: e.target.value})}
                      className="px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                      placeholder="DD"
                    />
                    <input
                      type="number"
                      min="1"
                      max="12"
                      value={formData.spouseMonth}
                      onChange={(e) => setFormData({...formData, spouseMonth: e.target.value})}
                      className="px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                      placeholder="MM"
                    />
                    <input
                      type="number"
                      min="1900"
                      max="2025"
                      value={formData.spouseYear}
                      onChange={(e) => setFormData({...formData, spouseYear: e.target.value})}
                      className="px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                      placeholder="YYYY"
                    />
                  </div>
                  <div className="flex gap-4">
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="radio"
                        name="spouseGender"
                        value="male"
                        checked={formData.spouseGender === 'male'}
                        onChange={(e) => setFormData({...formData, spouseGender: e.target.value})}
                        className="w-5 h-5"
                      />
                      <span>Male</span>
                    </label>
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="radio"
                        name="spouseGender"
                        value="female"
                        checked={formData.spouseGender === 'female'}
                        onChange={(e) => setFormData({...formData, spouseGender: e.target.value})}
                        className="w-5 h-5"
                      />
                      <span>Female</span>
                    </label>
                  </div>
                </div>

                <div className="flex gap-4">
                  <button
                    onClick={() => setStep(1)}
                    className="w-1/3 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300"
                  >
                    ← Back
                  </button>
                  <button
                    onClick={handleCalculate}
                    className="w-2/3 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-semibold hover:opacity-90"
                  >
                    Calculate Complete Analysis ✨
                  </button>
                </div>
              </div>
            )}
          </div>
        ) : (
          <div className="space-y-6">
            <button
              onClick={() => {setShowResults(false); setStep(1);}}
              className="mb-4 px-6 py-2 bg-white/20 backdrop-blur-sm text-white rounded-lg hover:bg-white/30"
            >
              ← New Analysis
            </button>

            {/* Comprehensive Number Encyclopedia */}
            <div className="bg-white rounded-2xl shadow-xl p-6">
              <h2 className="text-2xl font-bold text-purple-700 mb-4 flex items-center gap-2">
                <BookOpen size={24} />
                Complete Number Encyclopedia in Your Chart
              </h2>
              <p className="text-gray-600 mb-6">Understanding all 9 numbers and their influence on your life according to Pythagorean & Cheiro wisdom</p>
              
              <div className="space-y-4">
                {results.allNumbers.map((num, idx) => (
                  <div key={idx} className={`border-2 rounded-xl p-5 ${
                    num.count === 0 ? 'border-red-300 bg-red-50' :
                    num.count >= 2 ? 'border-green-300 bg-green-50' :
                    'border-gray-300 bg-gray-50'
                  }`}>
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex items-center gap-3">
                        <div className={`w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold ${
                          num.count === 0 ? 'bg-red-500 text-white' :
                          num.count >= 2 ? 'bg-green-500 text-white' :
                          'bg-purple-500 text-white'
                        }`}>
                          {num.number}
                        </div>
                        <div>
                          <h3 className="text-lg font-bold text-gray-800">{num.details.symbolism}</h3>
                          <p className="text-sm text-gray-600">{num.details.element} • {num.details.plane} • Planet: {num.details.planetaryInfluence}</p>
                        </div>
                      </div>
                      <div className={`px-3 py-1 rounded-full text-xs font-bold ${
                        num.count === 0 ? 'bg-red-200 text-red-800' :
                        num.count >= 2 ? 'bg-green-200 text-green-800' :
                        'bg-gray-200 text-gray-800'
                      }`}>
                        {num.count === 0 ? 'MISSING' : num.count >= 2 ? `${num.count}x STRONG` : 'Present'}
                      </div>
                    </div>
                    
                    <div className="grid md:grid-cols-2 gap-4 text-sm">
                      <div>
                        <p className="font-semibold text-gray-700 mb-1">Key Traits:</p>
                        <p className="text-gray-600">{num.details.keyTraits}</p>
                      </div>
                      <div>
                        <p className="font-semibold text-gray-700 mb-1">Life Purpose:</p>
                        <p className="text-gray-600">{num.details.lifePurpose}</p>
                      </div>
                      <div>
                        <p className="font-semibold text-gray-700 mb-1">Strengths:</p>
                        <p className="text-gray-600">{num.details.strengths}</p>
                      </div>
                      <div>
                        <p className="font-semibold text-gray-700 mb-1">Challenges:</p>
                        <p className="text-gray-600">{num.details.challenges}</p>
                      </div>
                      <div>
                        <p className="font-semibold text-gray-700 mb-1">Spiritual Lesson:</p>
                        <p className="text-gray-600">{num.details.spiritualLesson}</p>
                      </div>
                      <div>
                        <p className="font-semibold text-gray-700 mb-1">Career Paths:</p>
                        <p className="text-gray-600">{num.details.suitableCareer}</p>
                      </div>
                    </div>

                    {num.details.specialNote && (
                      <div className="mt-4 bg-yellow-100 border-l-4 border-yellow-500 p-3 rounded">
                        <p className="text-sm font-semibold text-yellow-900">⚠️ {num.details.specialNote}</p>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>

            {/* Rest of results continue... */}
            <div className="text-center text-white text-sm mt-8 pt-8 border-t border-white/20">
              <p className="font-semibold">Powered by Neela Foundation</p>
              <p className="text-gray-300 text-xs mt-2">Based on Pythagorean & Cheiro Numerology • Ancient Wisdom for Modern Life</p>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default LoShuGridApp;
